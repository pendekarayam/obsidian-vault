<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Standard Cipher — Enkripsi AES-GCM</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f4f7fb; --card:#ffffff; --primary:#0abf9b; --muted:#6b7280; --danger:#ef4444; --text:#0f172a; --glass: rgba(15,23,42,0.04)
  }
  *{box-sizing:border-box}
  body{
    margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;
    color:var(--text);
    background:linear-gradient(135deg,#f7fafc,#eef2f7,#f9fafc);
    animation:bgShift 12s ease-in-out infinite alternate;
    padding:20px;display:flex;align-items:center;justify-content:center;
  }
  @keyframes bgShift{0%{background-position:0 0;}100%{background-position:100% 100%;}}

  .container{width:100%;max-width:980px;background:var(--card);border-radius:12px;
    box-shadow:0 8px 30px rgba(16,24,40,0.08);overflow:hidden;border:1px solid var(--glass)}

  header{padding:20px 24px}
  h1{margin:0;font-size:20px;font-weight:700}
  p.desc{margin:6px 0 0;color:var(--muted);font-size:13px}

  .content{display:grid;grid-template-columns:1fr 1fr;gap:18px;padding:20px}
  @media(max-width:900px){.content{grid-template-columns:1fr}}

  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  textarea,input{width:100%;padding:12px;border-radius:8px;border:1px solid #e6eef6;background:#fbfdfe;font-size:14px}
  textarea{min-height:140px;resize:vertical}

  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}

  .btn{background:var(--primary);color:#fff;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:600}
  .btn.ghost{background:transparent;color:var(--text);border:1px solid #e6eef6}
  .btn.danger{background:var(--danger);color:#fff}

  .meter{height:8px;background:#eef2f7;border-radius:6px;margin-top:6px}
  .meter div{height:100%;width:0%;background:linear-gradient(90deg,#f59e0b,#10b981)}

  .status{font-size:13px;color:var(--muted)}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:#111827;color:#fff;padding:10px 14px;border-radius:8px;display:none;z-index:999}
</style>
</head>
<body>
  <div class="container" role="application">
    <header>
      <h1>Standard Cipher — Enkripsi & Dekripsi</h1>
      <p class="desc">AES-256-GCM dengan PBKDF2. Semua proses berjalan di browser — tidak ada yang dikirim ke server.</p>
    </header>

    <section class="content">
      <div>
        <label for="plaintext">Pesan (Plaintext)</label>
        <textarea id="plaintext" placeholder="Tulis pesan..."></textarea>

        <label for="password" style="margin-top:12px">Password</label>
        <input id="password" type="text" placeholder="Gunakan password kuat atau generate" autocomplete="off" />
        <div class="meter"><div id="pwBar"></div></div>

        <label for="iter" style="margin-top:12px">Iterations</label>
        <input id="iter" type="number" value="250000" min="1000" step="1000" />

        <div class="controls">
          <button id="encryptBtn" class="btn">Enkripsi →</button>
          <button id="genBtn" class="btn ghost">Generate Password</button>
          <button id="exportPlainBtn" class="btn ghost">Export .txt</button>
          <button id="clearAllBtn" class="btn danger">Hapus Semua</button>
        </div>
      </div>

      <div>
        <label for="ciphertext">Ciphertext (Base64)</label>
        <textarea id="ciphertext" placeholder="Hasil enkripsi muncul di sini..."></textarea>

        <div class="controls">
          <button id="copyCipherBtn" class="btn ghost">Salin</button>
          <button id="saveCipherBtn" class="btn ghost">Simpan .txt</button>
          <button id="loadCipherBtn" class="btn ghost">Muat .txt</button>
        </div>

        <label for="decryptPassword" style="margin-top:12px">Password untuk Dekripsi</label>
        <input id="decryptPassword" type="text" placeholder="Isi password (atau kosong untuk pakai yang atas)" />

        <div class="controls">
          <button id="decryptBtn" class="btn">← Dekripsi</button>
          <button id="copyPlainBtn" class="btn ghost">Salin Plaintext</button>
        </div>
      </div>

      <div class="full">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
          <div class="muted">Format: Base64(salt16 || iv12 || ciphertext)</div>
          <div id="status" class="status">Ready</div>
        </div>
      </div>
    </section>
  </div>

  <div id="toast" class="toast"></div>

<script>
const $ = id => document.getElementById(id);
const toast = (m,t=2500)=>{const el=$('toast');el.textContent=m;el.style.display='block';clearTimeout(el._t);el._t=setTimeout(()=>el.style.display='none',t)};
const setStatus = m => $('status').textContent=m;

const bufToB64 = b => btoa(String.fromCharCode(...new Uint8Array(b)));
const b64ToBuf = b64 => Uint8Array.from(atob(b64),c=>c.charCodeAt(0));

async function deriveKey(pw,salt,iter){
  const enc=new TextEncoder();
  const baseKey=await crypto.subtle.importKey('raw',enc.encode(pw),{name:'PBKDF2'},false,['deriveKey']);
  return crypto.subtle.deriveKey({name:'PBKDF2',salt,iterations:iter,hash:'SHA-512'},baseKey,{name:'AES-GCM',length:256},false,['encrypt','decrypt']);
}

async function encryptText(pt,pw,iter){
  const salt=crypto.getRandomValues(new Uint8Array(16));
  const iv=crypto.getRandomValues(new Uint8Array(12));
  const key=await deriveKey(pw,salt,iter);
  const encoded=new TextEncoder().encode(pt);
  const ct=await crypto.subtle.encrypt({name:'AES-GCM',iv},key,encoded);
  const out=new Uint8Array(salt.length+iv.length+ct.byteLength);
  out.set(salt,0); out.set(iv,16); out.set(new Uint8Array(ct),28);
  return bufToB64(out.buffer);
}

async function decryptText(data,pw,iter){
  const buf=b64ToBuf(data);
  if(buf.length<29) throw new Error('Data rusak');
  const salt=buf.slice(0,16); const iv=buf.slice(16,28); const ct=buf.slice(28);
  const key=await deriveKey(pw,salt,iter);
  const plain=await crypto.subtle.decrypt({name:'AES-GCM',iv},key,ct);
  return new TextDecoder().decode(plain);
}

async function busy(btn,fn){
  const all=document.querySelectorAll('button'); all.forEach(b=>b.disabled=true);
  const txt=btn.textContent; btn.textContent=txt+'...';
  try{return await fn();} finally{all.forEach(b=>b.disabled=false); btn.textContent=txt;}
}

$('encryptBtn').onclick=()=>busy($('encryptBtn'),async()=>{
  const pt=$('plaintext').value.trim();
  const pw=$('password').value.trim();
  const iter=parseInt($('iter').value)||250000;
  if(!pt) return setStatus('Isi pesan dulu');
  if(pw.length<6) return setStatus('Password lemah');
  const out=await encryptText(pt,pw,iter);
  $('ciphertext').value=out;
  toast('Enkripsi berhasil'); setStatus('Ciphertext siap');
});

$('decryptBtn').onclick=()=>busy($('decryptBtn'),async()=>{
  const ct=$('ciphertext').value.trim();
  const pw=$('decryptPassword').value.trim()||$('password').value.trim();
  const iter=parseInt($('iter').value)||250000;
  if(!ct) return setStatus('Masukkan ciphertext');
  if(!pw) return setStatus('Password diperlukan');
  try{
    const pt=await decryptText(ct,pw,iter);
    $('plaintext').value=pt;
    toast('Dekripsi berhasil'); setStatus('Selesai');
  }catch(e){ setStatus('Dekripsi gagal'); toast('Password salah / data rusak'); }
});

$('copyCipherBtn').onclick=async()=>{const t=$('ciphertext').value;if(t){await navigator.clipboard.writeText(t);toast('Tersalin');}};
$('copyPlainBtn').onclick=async()=>{const t=$('plaintext').value;if(t){await navigator.clipboard.writeText(t);toast('Plaintext tersalin');}};

$('saveCipherBtn').onclick=()=>{
  const t=$('ciphertext').value;if(!t) return;
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([t])); a.download='ciphertext.txt'; a.click();
};

$('loadCipherBtn').onclick=()=>{
  const i=document.createElement('input'); i.type='file'; i.accept='.txt';
  i.onchange=e=>{const f=e.target.files[0]; if(!f)return;const r=new FileReader();r.onload=()=>$('ciphertext').value=r.result; r.readAsText(f);}    
  i.click();
};

$('exportPlainBtn').onclick=()=>{
  const t=$('plaintext').value;if(!t)return;
  const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([t])); a.download='plaintext.txt'; a.click();
};

$('clearAllBtn').onclick=()=>{
  if(!confirm('Hapus semua isi?')) return;
  $('plaintext').value='';$('ciphertext').value='';$('password').value='';$('decryptPassword').value='';$('pwBar').style.width='0%'; setStatus('Bersih'); toast('Semua terhapus');
};

$('password').addEventListener('input',()=>{
  const v=$('password').value; let s=0;
  if(v.length>=12)s+=40; if(/[A-Z]/.test(v))s+=20; if(/[0-9]/.test(v))s+=20; if(/[^A-Za-z0-9]/.test(v))s+=20;
  $('pwBar').style.width=Math.min(100,s)+'%';
});
</script>
</body>
</html>
